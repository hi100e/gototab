<!DOCTYPE html>
<html lang="en">
<!-- 
Looking into the source code of the index.html file, I can see.

We applaud your curoisity!!.

This is a quick and simple vanilla html/js/css search tool to quickly search across
multiple search engines. Currently defaults to DuckDuckGo. 

This is a single html with no build, no dependencies, no build process and no backend server or api.

It is a single page application that uses localStorage to store the recent searches 
and quick notes.  

Do not use it for note taking since the brwoser might clear it, if not accessed (e.g Safari)


You deply your own. fork and deply to your github pages or cloudflare pages.

or you use (my.gototab.com) which is used only to deliver the html file (and some css file).

-->
<head>
	<meta charset="UTF-8">
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<!-- <link rel="manifest" href="/site.webmanifest"> -->
	<!--<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">  -->
	<meta name="msapplication-TileColor" content="#da532c">
	<!--<meta name="viewport" content="width=device-width, initial-scale=1.0"> -->
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="referrer" content="no-referrer">
	<title>My GotoTab</title>
	<link rel="stylesheet" href="assets/a11yana.min.css">
	<link rel="stylesheet" href="gototab.css" />
</head>

<body id="body" class="main-container">

	<h1 style="width:640px">
		<span style="display: flex; justify-content: center;"><strong>GotoTab</strong></span>
		<p></p>
		<span><input style="width:640px ;" id="q" name="q" placeholder="Search..." autofocus="1"></input></span>
		<div id="engines" style="display: flex; flex-wrap: wrap; justify-content: center; margin: 10px;">
			<!-- generated by javascript-->
		</div>

		<div class="todo-card">
			<textarea id="todoNotes" oninput="saveTodos();"></textarea>
		</div>
	</h1>

	<div id="latest" ondblclick="clearRecents();" style="z-index: 0;">
		<span style=" text-align: left;">
			<p></p>

			<div id="latestSearches">
			</div>

		</span>

	</div>




</body>

<script>
	//from https://developer.mozilla.org
	async function digestMessage(message) {
		const msgUint8 = new TextEncoder().encode(message);                           // encode as (utf-8) Uint8Array
		const hashBuffer = await crypto.subtle.digest('SHA-256', msgUint8);           // hash the message
		const hashArray = Array.from(new Uint8Array(hashBuffer));                     // convert buffer to byte array
		const hashHex = hashArray.map((b) => b.toString(16).padStart(2, '0')).join(''); // convert bytes to hex string
		return hashHex;
	}

	function hashTab(message) {
		digestMessage(message).then(function (result) {
			return result;
		}
		);
	}
	function doSearch(engineId, target) {


		let q = document.getElementById('q').value;
		if (!q) {
			return;
		}
		doQuery(engineId, target, q);

	}
	function doQuery(engineId, target, q) {

		if (!q) {
			return;
		}
		let engine = window.srch.engines[engineId];
		if (!engine) {
			//ignore
			return
		}

	 let url = `https://${engine}`.replace("${Q}", encodeURIComponent(q));
    
    // Open immediately - no async delays
	// avoid popup blockers
    let w = window.open(url, "_blank");
    if (w) w.focus();

	updateRecent(url, engineId,q)	

	}

	function updateRecent(target,engineId,q) {
		if (!target) {
			console.error("target is null. should not happen");
			return;
		}

		if (window.srch.recent[target]) {
			//same search was done recently, remove it and
			//add it again so its on the top of the list
			delete window.srch.recent[target];
		}
		let ts = Date.name;
		window.srch.recent[target] = { "engineId": engineId, "q": q, "ts": ts };

		//refresh recent
		refreshRecents();
	}

	function clearRecents() {
		window.srch.recent = {};
		refreshRecents();
	}
	function refreshRecents() {

		let recents = [];
		for (const [key, value] of Object.entries(window.srch.recent)) {
			let item = `<li ondblclick="doQuery('${value.engineId}',null,window.srch.recent['${key}'].q);" >${value.engineId}: ${value.q}`;
			recents.push(item);
		}
		let recentHtml = "";
		if (recents.length > 0) {
			recentHtml = `<strong>Latest:</strong><lo>`;
			//in reverse,  most recent first
			for (let i = recents.length - 1; i >= 0; i--) {
				recentHtml += recents[i];
			}
			recentHtml += "</lo>"
		}

		let recentList = document.getElementById('latestSearches');
		recentList.innerHTML = recentHtml;
	}

	async function loadTodos() {
		let todos = localStorage.getItem("gototab_todos");
		let todoElem = document.getElementById('todoNotes');
		if (todos && todoElem) {
			todoElem.value = todos;
		}
	}
	async function saveTodos() {

		let todoElem = document.getElementById('todoNotes');
		if (todoElem) {
			localStorage.setItem("gototab_todos", todoElem.value);
		}
	}

	function initialize() {
		window.srch = {};
		window.srch.tabs = {};
		window.srch.recent = {};
		window.srch.engines = {};
		window.srch.engines["DuckDuckGo"] = "duckduckgo.com?q=${Q}";
		window.srch.engines["Google"] = "google.com/search?q=${Q}";
		window.srch.engines["YouTube"] = "www.youtube.com/results?search_query=${Q}";
		window.srch.engines["LinkedIn"] = "www.linkedin.com/search/results/all/?keywords=${Q}";
		window.srch.engines["Google Maps"] = "www.google.co.uk/maps/search/${Q}";
		window.srch.engines["StackOverflow"] = "duckduckgo.com?q=!sod ${Q}";
		window.srch.engines["Wikipedia"] = "en.wikipedia.org/w/index.php?fulltext=1&search=${Q}&ns0=1";

		window.srch.defaultEngine = "DuckDuckGo";

		window.srch.recent = {};

		let enginesButtonsHtml = "";

		for (const [key, value] of Object.entries(window.srch.engines)) {
			enginesButtonsHtml += `<input type="button" style="margin: 5px;" value="${key}" OnClick="doSearch('${key}');" ></button>`;
		}

		let enginesButtons = document.getElementById('engines');
		enginesButtons.innerHTML = enginesButtonsHtml;

		let qBox = document.getElementById('q');
		qBox.onkeypress = function (e) {
			if (e.charCode === 13) {
				doSearch(window.srch.defaultEngine);
			}
		}

		window.addEventListener('focus', (event) => {
			let qBox = document.getElementById('q');
			qBox.select();
			qBox.focus();
		});

		window.addEventListener("beforeunload", function (e) {
			let confirmationMessage = 'Are you sure?';

			(e || window.event).returnValue = confirmationMessage; //Gecko + IE
			return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
		});

		//load todo notes
		loadTodos();
	}

	initialize();
</script>

</html>